#!/bin/bash
#
# commit-msg hook for skills-jk
# Co-Author 형식을 검증합니다.
#
# 설치: cp .github/hooks/commit-msg .git/hooks/commit-msg && chmod +x .git/hooks/commit-msg

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# 색상 정의
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m'

# Co-Author 패턴 검사
if echo "$COMMIT_MSG" | grep -qiE "Co-Authored-By:.*Claude|Co-Authored-By:.*anthropic"; then
    echo -e "${RED}❌ 잘못된 Co-Author 형식${NC}" >&2
    echo "" >&2
    echo "발견: Claude/Anthropic 형식" >&2
    echo "필요: Co-Authored-By: Atlas <atlas@jk.agent>" >&2
    echo "" >&2
    echo "커밋 메시지를 수정하세요:" >&2
    echo "  git commit --amend" >&2
    exit 1
fi

# Co-Author가 있는데 Atlas 형식이 아닌 경우 경고
if echo "$COMMIT_MSG" | grep -qiE "Co-Authored-By:" && ! echo "$COMMIT_MSG" | grep -q "Co-Authored-By: Atlas <atlas@jk.agent>"; then
    echo -e "${YELLOW}⚠️  Co-Author 형식 확인 필요${NC}" >&2
    echo "권장: Co-Authored-By: Atlas <atlas@jk.agent>" >&2
fi

exit 0
